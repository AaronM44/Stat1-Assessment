---
title: "Stats1 Assessment"
author: "Aaron Munro"
date: "2022-12-10"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

## Main Findings
- A weak positive correlation between median temperature and beer consumption exists.
- For an increase in temperature of 1 degree Celsius we would expect an increase in beer consumption of 0.2 litres.
- Linear regression analysis produced a low r-squared value suggesting the relationship does not sufficiently explain the variance in the data.
- Simple linear regression model resulted in a p-value of 0.0006445 suggesting that the relationship is significant.
- Multiple regression model showed improvement in p-value and adjusted r-squared but not significantly.
- Sample of data possibly too small to be representative of population.

## Executive Summary
In 2015 data was gathered related to the volume of beer consumed by groups of students in Sao Paulo, Brazil and the weather across the year. This report aimed to understand whether there was a relationship between temperature and the amount of beer consumed. Linear regression was chosen as the method to describe the relationship as the variables in question were both quantitative. The result was a very weak linear relationship that showed as the temperature increases by 1 degree Celsius beer consumption also increases by around 0.2 litres. However, the data also contained a large amount of variance which was shown to be the case via a low R-Squared value. Moving to a multiple linear regression model with median, minimum and maximum temperature showed a very slight improvement when compared to the simple model but it was not significant enough to change the assessment.

## Introduction
The dataset I chose to use for the assessment was found on Kaggle. Over a period of a year in 2015, data was collected containing the beer consumption of students around a university area in Sao Paulo, Brazil. The dataset also contains the temperature and volume of precipitation for each day. There is one piece of data missing that I would consider crucial and that is the number of students that data was collected from.

The original columns were in Portugese and were translated for this project:

- Data - Date
- Temperatura Media (C) - Median Temp. (C)
- Temperatura Minima (C) - Min. Temp (C)
- Temperatura Maxima (C) - Max. Temp (C)
- Precipitacao (mm) - Precipitation (mm)
- Final de Semana - Weekend
- Consumo de cerveja (litros) - Consumption (litres)


### Hypothesis
Is there a relationship between temperature and beer consumption among students in Sao Paulo, Brazil?

H0 - There is no significant relationship between temperature and beer consumption among students.

H1 - There is a significant relationship between temperature and beer consumption among students.

``` {r imports, echo=FALSE}
# Import packages
library(tidyverse)
library(broom)
library(patchwork)
library(lubridate)
library(corrplot)
library(tidymodels)
library(ggfortify)
```

### Original Dataset Analysis

``` {r orig_read, echo=FALSE}
# Import data - dataset has commas instead of decimal points and many blank rows
orig_data <- read.csv("data/Consumo_cerveja.csv", dec = ",")
orig_data <- orig_data[1:365,]

set.seed(7)
```

``` {r orig_rename, echo=FALSE}
# Rename columns
orig_data <- orig_data %>%
  rename(date = Data,
         temp_median = Temperatura.Media..C.,
         temp_min = Temperatura.Minima..C.,
         temp_max = Temperatura.Maxima..C.,
         precip = Precipitacao..mm.,
         weekend = Final.de.Semana,
         consum = Consumo.de.cerveja..litros.)
```

``` {r orig_head, echo=FALSE}
head(orig_data)
```

``` {r orig_comma_rep, echo=FALSE}
# Format fields correctly
orig_data$date <- as_date(as.Date(orig_data$date))
orig_data$temp_median <- as.numeric(orig_data$temp_median)
orig_data$temp_min <- as.numeric(orig_data$temp_min)
orig_data$temp_max <- as.numeric(orig_data$temp_max)
orig_data$precip <- as.numeric(orig_data$precip)
orig_data$weekend <- as.factor(orig_data$weekend)
orig_data$consum <- as.numeric(as.character(orig_data$consum))
```

``` {r orig_summary, echo=FALSE}
summary(orig_data)
```

``` {r orig_add_month, echo=FALSE}
# Add month column
orig_data <- orig_data %>%
  mutate(mo = month(date))
```

``` {r orig_distr, echo=FALSE}
orig_p1 <- ggplot(orig_data, aes(x = temp_median)) +
  geom_histogram(bins = 10) +
  labs(title = "Distribution of Median Temperature",
       x = "Temperature (C)",
       y = "Count") +
  geom_vline(aes(xintercept = mean(temp_median)),col='red',linewidth=0.5) +
  geom_vline(aes(xintercept = median(temp_median)),col='green',linewidth=0.5)

orig_p2 <- ggplot(orig_data, aes(x = temp_min)) +
  geom_histogram(bins = 10) +
  labs(title = "Distribution of Min. Temperature",
       x = "Temperature (C)",
       y = "Count") +
  geom_vline(aes(xintercept = mean(temp_min)),col='red',linewidth=0.5) +
  geom_vline(aes(xintercept = median(temp_min)),col='green',linewidth=0.5)

orig_p3 <- ggplot(orig_data, aes(x = temp_max)) +
  geom_histogram(bins = 10) +
  labs(title = "Distribution of Max. Temperature",
       x = "Temperature (C)",
       y = "Count") +
  geom_vline(aes(xintercept = mean(temp_max)),col='red',linewidth=0.5) +
  geom_vline(aes(xintercept = median(temp_max)),col='green',linewidth=0.5)

orig_p4 <- ggplot(orig_data, aes(x = precip)) +
  geom_histogram(bins = 10) +
  labs(title = "Distribution of Precipitation",
       x = "Precipitation (mm)",
       y = "Count") +
  geom_vline(aes(xintercept = mean(precip)),col='red',linewidth=0.5) +
  geom_vline(aes(xintercept = median(precip)),col='green',linewidth=0.5)

orig_p5 <- ggplot(orig_data, aes(x = weekend)) +
  geom_bar() +
  labs(title = "Count of Weekdays vs Weekends",
       x = "Weekend",
       y = "Count")

orig_p6 <- ggplot(orig_data, aes(x = consum)) +
  geom_histogram(bins = 10) +
  labs(title = "Distribution of Beer Consumption",
       x = "Consumption (litres)",
       y = "Count") +
  geom_vline(aes(xintercept = mean(consum)),col='red',linewidth=0.5) +
  geom_vline(aes(xintercept = median(consum)),col='green',linewidth=0.5)

orig_patchwork <- orig_p1 + orig_p2 + orig_p3 + orig_p4 + orig_p5 + orig_p6
orig_patchwork + plot_annotation(
  title = 'Original Dataset Overview',
  subtitle = 'Red Line - Mean, Green Line - Median'
)
```

``` {r orig_time, echo=FALSE}
orig_time_p1 <- ggplot(orig_data, aes(x = mo, y = temp_median, group = mo)) +
  geom_boxplot() +
  scale_x_continuous(breaks = seq(1,12,1)) +
  stat_summary(fun = "mean", aes(ymax = after_stat(y), ymin = after_stat(y)), 
               color = "red", shape = 4)

orig_time_p2 <- ggplot(orig_data, aes(x = mo, y = temp_min, group = mo)) +
  geom_boxplot() +
  scale_x_continuous(breaks = seq(1,12,1)) +
  stat_summary(fun = "mean", aes(ymax = after_stat(y), ymin = after_stat(y)), 
               color = "red", shape = 4)

orig_time_p3 <- ggplot(orig_data, aes(x = mo, y = temp_max, group = mo)) +
  geom_boxplot() +
  scale_x_continuous(breaks = seq(1,12,1)) +
  stat_summary(fun = "mean", aes(ymax = after_stat(y), ymin = after_stat(y)), 
               color = "red", shape = 4)

orig_time_p4 <- ggplot(orig_data, aes(x = mo, y = precip, group = mo)) +
  geom_boxplot() +
  scale_x_continuous(breaks = seq(1,12,1)) +
  stat_summary(fun = "mean", aes(ymax = after_stat(y), ymin = after_stat(y)), 
               color = "red", shape = 4)

orig_time_p5 <- ggplot(orig_data, aes(x = mo, y = consum, group = mo)) +
  geom_boxplot() +
  scale_x_continuous(breaks = seq(1,12,1)) +
  stat_summary(fun = "mean", aes(ymax = after_stat(y), ymin = after_stat(y)), 
               color = "red", shape = 4)

orig_patchwork <- orig_time_p1 + orig_time_p2 + orig_time_p3 + 
  orig_time_p4 + orig_time_p5
orig_patchwork + plot_annotation(
  title = 'Continuous Variables by Month'
)
```

``` {r orig_rain_chance, echo=FALSE}
# Create column for whether it rained on a particular day or not
orig_data <- orig_data %>%
  mutate(rained = ifelse(precip > 0, 1, 0))

# Calculate chance of rain for each month
orig_data %>%
  group_by(mo) %>%
  summarise(rain_days = length(rained[rained==1]),
            mo_days = length(mo),
            rain_chance = length(rained[rained==1])/length(mo))

# Distribution of precipitation on the days it rained
orig_data %>%
  filter(rained == 1) %>%
  ggplot(aes(x = mo, y = precip, group = mo)) +
  geom_boxplot() +
  scale_x_continuous(breaks = seq(1,12,1)) +
  stat_summary(fun = "mean", aes(ymax = after_stat(y), ymin = after_stat(y)), 
               color = "red", shape = 4)
```

## Method

The simulated data was created by Looking at the distribution of each variable by month. This was used as it would not make sense for the range of temperatures to be random throughout the year as would be the case if we just used the entire dataset. For each of the temperature variables and also beer consumption this worked quite well.

Precipitation however, ended up producing many values less than zero which wouldn't make sense. These values were set to zero to simulate the fact that it would not rain every day.

The continuous variables were all appended together in month order. A sequence of dates throughout the year were then generated and used to also add the weekend column.

Our hypothesis relies upon assessing the relationship between two clearly defined continuous quantitative variables therefore the statistical test chosen was linear regression.




``` {r sim_date, echo=FALSE}
# Start date
start_date <- ymd("2015/01/01")
  
# End date
end_date <- ymd("2015/12/31")
  
# Create range of dates
dates <- seq(start_date, end_date,"days")
```

``` {r sim_temp_median, echo=FALSE}
# Get mean and standard deviation for each month
temp_med_stat <- orig_data %>%
  group_by(mo) %>%
  summarise(mean = mean(temp_median), sd = sd(temp_median))

# Create distributions
temp_med_jan <- rnorm(31, mean=temp_med_stat$mean[[1]], sd=temp_med_stat$sd[[1]])
temp_med_feb <- rnorm(28, mean=temp_med_stat$mean[[2]], sd=temp_med_stat$sd[[2]])
temp_med_mar <- rnorm(31, mean=temp_med_stat$mean[[3]], sd=temp_med_stat$sd[[3]])
temp_med_apr <- rnorm(30, mean=temp_med_stat$mean[[4]], sd=temp_med_stat$sd[[4]])
temp_med_may <- rnorm(31, mean=temp_med_stat$mean[[5]], sd=temp_med_stat$sd[[5]])
temp_med_jun <- rnorm(30, mean=temp_med_stat$mean[[6]], sd=temp_med_stat$sd[[6]])
temp_med_jul <- rnorm(31, mean=temp_med_stat$mean[[7]], sd=temp_med_stat$sd[[7]])
temp_med_aug <- rnorm(31, mean=temp_med_stat$mean[[8]], sd=temp_med_stat$sd[[8]])
temp_med_sep <- rnorm(30, mean=temp_med_stat$mean[[9]], sd=temp_med_stat$sd[[9]])
temp_med_oct <- rnorm(31, mean=temp_med_stat$mean[[10]], sd=temp_med_stat$sd[[10]])
temp_med_nov <- rnorm(30, mean=temp_med_stat$mean[[11]], sd=temp_med_stat$sd[[11]])
temp_med_dec <- rnorm(31, mean=temp_med_stat$mean[[12]], sd=temp_med_stat$sd[[12]])

# Combine into a single vector
temp_med <- c(temp_med_jan, temp_med_feb, temp_med_mar, temp_med_apr,
                   temp_med_may, temp_med_jun, temp_med_jul, temp_med_aug,
                   temp_med_sep, temp_med_oct, temp_med_nov, temp_med_dec)
```

``` {r sim_temp_min, echo=FALSE}
# Get mean and standard deviation for each month
temp_min_stat <- orig_data %>%
  group_by(mo) %>%
  summarise(mean = mean(temp_min), sd = sd(temp_min))

# Create distributions
temp_min_jan <- rnorm(31, mean=temp_min_stat$mean[[1]], sd=temp_min_stat$sd[[1]])
temp_min_feb <- rnorm(28, mean=temp_min_stat$mean[[2]], sd=temp_min_stat$sd[[2]])
temp_min_mar <- rnorm(31, mean=temp_min_stat$mean[[3]], sd=temp_min_stat$sd[[3]])
temp_min_apr <- rnorm(30, mean=temp_min_stat$mean[[4]], sd=temp_min_stat$sd[[4]])
temp_min_may <- rnorm(31, mean=temp_min_stat$mean[[5]], sd=temp_min_stat$sd[[5]])
temp_min_jun <- rnorm(30, mean=temp_min_stat$mean[[6]], sd=temp_min_stat$sd[[6]])
temp_min_jul <- rnorm(31, mean=temp_min_stat$mean[[7]], sd=temp_min_stat$sd[[7]])
temp_min_aug <- rnorm(31, mean=temp_min_stat$mean[[8]], sd=temp_min_stat$sd[[8]])
temp_min_sep <- rnorm(30, mean=temp_min_stat$mean[[9]], sd=temp_min_stat$sd[[9]])
temp_min_oct <- rnorm(31, mean=temp_min_stat$mean[[10]], sd=temp_min_stat$sd[[10]])
temp_min_nov <- rnorm(30, mean=temp_min_stat$mean[[11]], sd=temp_min_stat$sd[[11]])
temp_min_dec <- rnorm(31, mean=temp_min_stat$mean[[12]], sd=temp_min_stat$sd[[12]])

# Combine into a single vector
temp_min_df <- c(temp_min_jan, temp_min_feb, temp_min_mar, temp_min_apr,
                   temp_min_may, temp_min_jun, temp_min_jul, temp_min_aug,
                   temp_min_sep, temp_min_oct, temp_min_nov, temp_min_dec)
```

``` {r sim_temp_max, echo=FALSE}
# Get mean and standard deviation for each month
temp_max_stat <- orig_data %>%
  group_by(mo) %>%
  summarise(mean = mean(temp_max), sd = sd(temp_max))

# Create distributions
temp_max_jan <- rnorm(31, mean=temp_max_stat$mean[[1]], sd=temp_max_stat$sd[[1]])
temp_max_feb <- rnorm(28, mean=temp_max_stat$mean[[2]], sd=temp_max_stat$sd[[2]])
temp_max_mar <- rnorm(31, mean=temp_max_stat$mean[[3]], sd=temp_max_stat$sd[[3]])
temp_max_apr <- rnorm(30, mean=temp_max_stat$mean[[4]], sd=temp_max_stat$sd[[4]])
temp_max_may <- rnorm(31, mean=temp_max_stat$mean[[5]], sd=temp_max_stat$sd[[5]])
temp_max_jun <- rnorm(30, mean=temp_max_stat$mean[[6]], sd=temp_max_stat$sd[[6]])
temp_max_jul <- rnorm(31, mean=temp_max_stat$mean[[7]], sd=temp_max_stat$sd[[7]])
temp_max_aug <- rnorm(31, mean=temp_max_stat$mean[[8]], sd=temp_max_stat$sd[[8]])
temp_max_sep <- rnorm(30, mean=temp_max_stat$mean[[9]], sd=temp_max_stat$sd[[9]])
temp_max_oct <- rnorm(31, mean=temp_max_stat$mean[[10]], sd=temp_max_stat$sd[[10]])
temp_max_nov <- rnorm(30, mean=temp_max_stat$mean[[11]], sd=temp_max_stat$sd[[11]])
temp_max_dec <- rnorm(31, mean=temp_max_stat$mean[[12]], sd=temp_max_stat$sd[[12]])

# Combine into a single vector
temp_max_df <- c(temp_max_jan, temp_max_feb, temp_max_mar, temp_max_apr,
                   temp_max_may, temp_max_jun, temp_max_jul, temp_max_aug,
                   temp_max_sep, temp_max_oct, temp_max_nov, temp_max_dec)
```

``` {r sim_precip, echo=FALSE}
# Get mean and standard deviation for each month
precip_stat <- orig_data %>%
  group_by(mo) %>%
  summarise(mean = mean(precip), sd = sd(precip))

# Create distributions
precip_jan <- rnorm(31, mean=precip_stat$mean[[1]], sd=precip_stat$sd[[1]])
precip_feb <- rnorm(28, mean=precip_stat$mean[[2]], sd=precip_stat$sd[[2]])
precip_mar <- rnorm(31, mean=precip_stat$mean[[3]], sd=precip_stat$sd[[3]])
precip_apr <- rnorm(30, mean=precip_stat$mean[[4]], sd=precip_stat$sd[[4]])
precip_may <- rnorm(31, mean=precip_stat$mean[[5]], sd=precip_stat$sd[[5]])
precip_jun <- rnorm(30, mean=precip_stat$mean[[6]], sd=precip_stat$sd[[6]])
precip_jul <- rnorm(31, mean=precip_stat$mean[[7]], sd=precip_stat$sd[[7]])
precip_aug <- rnorm(31, mean=precip_stat$mean[[8]], sd=precip_stat$sd[[8]])
precip_sep <- rnorm(30, mean=precip_stat$mean[[9]], sd=precip_stat$sd[[9]])
precip_oct <- rnorm(31, mean=precip_stat$mean[[10]], sd=precip_stat$sd[[10]])
precip_nov <- rnorm(30, mean=precip_stat$mean[[11]], sd=precip_stat$sd[[11]])
precip_dec <- rnorm(31, mean=precip_stat$mean[[12]], sd=precip_stat$sd[[12]])

precip_df <- c(precip_jan, precip_feb, precip_mar, precip_apr,
                   precip_may, precip_jun, precip_jul, precip_aug,
                   precip_sep, precip_oct, precip_nov, precip_dec)

# Combine into a single vector
precip_df <- replace(precip_df, precip_df < 0, 0)
```

``` {r sim_consum, echo=FALSE}
# Get mean and standard deviation for each month
consum_stat <- orig_data %>%
  group_by(mo) %>%
  summarise(mean = mean(consum), sd = sd(consum))

# Create distributions
consum_jan <- rnorm(31, mean=consum_stat$mean[[1]], sd=consum_stat$sd[[1]])
consum_feb <- rnorm(28, mean=consum_stat$mean[[2]], sd=consum_stat$sd[[2]])
consum_mar <- rnorm(31, mean=consum_stat$mean[[3]], sd=consum_stat$sd[[3]])
consum_apr <- rnorm(30, mean=consum_stat$mean[[4]], sd=consum_stat$sd[[4]])
consum_may <- rnorm(31, mean=consum_stat$mean[[5]], sd=consum_stat$sd[[5]])
consum_jun <- rnorm(30, mean=consum_stat$mean[[6]], sd=consum_stat$sd[[6]])
consum_jul <- rnorm(31, mean=consum_stat$mean[[7]], sd=consum_stat$sd[[7]])
consum_aug <- rnorm(31, mean=consum_stat$mean[[8]], sd=consum_stat$sd[[8]])
consum_sep <- rnorm(30, mean=consum_stat$mean[[9]], sd=consum_stat$sd[[9]])
consum_oct <- rnorm(31, mean=consum_stat$mean[[10]], sd=consum_stat$sd[[10]])
consum_nov <- rnorm(30, mean=consum_stat$mean[[11]], sd=consum_stat$sd[[11]])
consum_dec <- rnorm(31, mean=consum_stat$mean[[12]], sd=consum_stat$sd[[12]])

# Combine into a single vector
consum_df <- c(consum_jan, consum_feb, consum_mar, consum_apr,
                   consum_may, consum_jun, consum_jul, consum_aug,
                   consum_sep, consum_oct, consum_nov, consum_dec)
```

``` {r sim_data, echo=FALSE}
# Create the data
sim_data <- tibble(
  date = dates,
  temp_median = temp_med,
  temp_min = temp_min_df,
  temp_max = temp_max_df,
  precip = precip_df,
  consum = consum_df
) %>%
  mutate(across(where(is.numeric), round, digits = 2))

# Add month column
sim_data <- sim_data %>%
  mutate(mo = month(date))

# Add the weekend column
sim_data <- sim_data %>%
  mutate(weekend = ifelse(wday(date, week_start = 1) %in% c(6, 7), "Weekend", "Weekday"))
```

``` {r sim_distr, echo=FALSE}
sim_dist_p1 <- ggplot(sim_data, aes(x = temp_median)) +
  geom_histogram(bins = 10) +
  labs(title = "Distribution of Median Temperature",
       x = "Temperature (C)",
       y = "Count") +
  geom_vline(aes(xintercept = mean(temp_median)),col='red',linewidth=0.5) +
  geom_vline(aes(xintercept = median(temp_median)),col='green',linewidth=0.5)

sim_dist_p2 <- ggplot(sim_data, aes(x = temp_min)) +
  geom_histogram(bins = 10) +
  labs(title = "Distribution of Min. Temperature",
       x = "Temperature (C)",
       y = "Count") +
  geom_vline(aes(xintercept = mean(temp_min)),col='red',linewidth=0.5) +
  geom_vline(aes(xintercept = median(temp_min)),col='green',linewidth=0.5)

sim_dist_p3 <- ggplot(sim_data, aes(x = temp_max)) +
  geom_histogram(bins = 10) +
  labs(title = "Distribution of Max. Temperature",
       x = "Temperature (C)",
       y = "Count") +
  geom_vline(aes(xintercept = mean(temp_max)),col='red',linewidth=0.5) +
  geom_vline(aes(xintercept = median(temp_max)),col='green',linewidth=0.5)

sim_dist_p4 <- ggplot(sim_data, aes(x = precip)) +
  geom_histogram(bins = 10) +
  labs(title = "Distribution of Precipitation",
       x = "Precipitation (mm)",
       y = "Count") +
  geom_vline(aes(xintercept = mean(precip)),col='red',linewidth=0.5) +
  geom_vline(aes(xintercept = median(precip)),col='green',linewidth=0.5)

sim_dist_p5 <- ggplot(orig_data, aes(x = weekend)) +
  geom_bar() +
  labs(title = "Count of Weekdays vs Weekends",
       x = "Weekend",
       y = "Count")

sim_dist_p6 <- ggplot(sim_data, aes(x = consum)) +
  geom_histogram(bins = 10) +
  labs(title = "Distribution of Beer Consumption",
       x = "Consumption (litres)",
       y = "Count") +
  geom_vline(aes(xintercept = mean(consum)),col='red',linewidth=0.5) +
  geom_vline(aes(xintercept = median(consum)),col='green',linewidth=0.5)

sim_patchwork_1 <- sim_dist_p1 + sim_dist_p2 + sim_dist_p3 + sim_dist_p4 +
  sim_dist_p5 + sim_dist_p6
sim_patchwork_1 + plot_annotation(
  title = 'Simulated Dataset Overview',
  subtitle = 'Red Line - Mean, Green Line - Median'
)
```

We first created a correlation matrix to understand the strength of correlations between each variable as a multiple linear relationship could have been more appropriate. None of the variables had a strong correlation with beer consumption. The temperature variables were all around the 0.17-0.20 range with precipitation even weaker at 0.13.

``` {r sim_corr_plot, echo=FALSE}
# Select the columns
cor_matrix <- sim_data %>%
  select(temp_median:consum)

# Create the correlation matrix
cor_matrix <- round(cor(cor_matrix, use = "complete.obs"), 2)

# Show matrix
cor_matrix

# Plot matrix
corrplot(cor_matrix, method="circle", type = "upper")
```

### Median Temperature

``` {r temp_med_mean, echo=FALSE}

sim_data %>%
  summarise(mean = mean(consum))
```

``` {r temp_med_corr, echo=FALSE}

cor(sim_data$temp_median, sim_data$consum)

p_corr_temp_med <- ggplot(sim_data, aes(x=temp_median, y=consum)) + 
  geom_smooth(method = "lm", color = "blue", fill = "lightblue", linewidth = 1, formula = y ~ x) +
  geom_point() +
  labs(x="Median Temperature (C)", y = "Beer Consumption (litres)")

p_corr_temp_med
```

#### Q-Q Plot

``` {r temp_med_qq, echo=FALSE}

ggplot(sim_data, aes(sample = consum)) +
  geom_qq() +
  geom_qq_line() +
  labs(title = "Beer Consumption - Q-Q Plot",
       x = "Theoretical Quantiles of Normal Distribution",
       y = "Beer Consumption (litres)")
```


#### Variance


``` {r temp_med_var, echo=FALSE}

sim_data %>%
  summarise(var = var(consum))
```


### Minimum Temperature


``` {r temp_min_corr, echo=FALSE}

cor(sim_data$temp_min, sim_data$consum)

p_corr_temp_min <- ggplot(sim_data, aes(x=temp_min, y=consum)) + 
  geom_smooth(method = "lm", color = "blue", fill = "lightblue", linewidth = 1, formula = y ~ x) +
  geom_point() +
  labs(x="Min. Temperature (C)", y = "Beer Consumption (litres)")

p_corr_temp_min
```

### Maximum Temperature


``` {r temp_max_corr, echo=FALSE}

cor(sim_data$temp_max, sim_data$consum)

p_corr_temp_max <- ggplot(sim_data, aes(x=temp_max, y=consum)) + 
  geom_smooth(method = "lm", color = "blue", fill = "lightblue", linewidth = 1, formula = y ~ x) +
  geom_point() +
  labs(x="Max. Temperature (C)", y = "Beer Consumption (litres)")

p_corr_temp_max
```

### Precipitation


``` {r precip_corr, echo=FALSE}

cor(sim_data$precip, sim_data$consum)

p_corr_precip <- ggplot(sim_data, aes(x=precip, y=consum)) + 
  geom_smooth(method = "lm", color = "blue", fill = "lightblue", linewidth = 1, formula = y ~ x) +
  geom_point() +
  labs(x="Precipitation (mm)", y = "Beer Consumption (litres)")

p_corr_precip
```

### Month

``` {r mo_corr, echo=FALSE}

cor(sim_data$mo, sim_data$consum)

ggplot(sim_data, aes(x = mo, y = consum, group = mo)) +
  geom_boxplot() +
  scale_x_continuous(breaks = seq(1,12,1)) +
  stat_summary(fun = "mean", aes(ymax = after_stat(y), ymin = after_stat(y)), 
               color = "red", shape = 4) +
  labs(x="Month", y = "Beer Consumption (litres)")
```

``` {r consum_time, echo=FALSE}
ggplot(sim_data, aes(x = date, y = consum)) + 
  geom_smooth(method = "lm", color = "blue", fill = "lightblue", linewidth = 1, formula = y ~ x) +
  geom_point() +
  geom_vline(xintercept = as.numeric(as.Date(c("2015-04-01","2015-07-01", "2015-10-01"))),
               linetype = "dashed", linewidth = 0.5, col = "gray")+
    annotate("text", x = as.Date("2015-02-01"), y = 8, label = "Summer", size = 5, col = "gray")+
    annotate("text", x = as.Date("2015-05-01"), y = 8, label = "Autumn", size = 5, col = "gray")+
    annotate("text", x = as.Date("2015-08-01"), y = 8, label = "Winter", size = 5, col = "gray")+
    annotate("text", x = as.Date("2015-11-01"), y = 8, label = "Spring", size = 5, col = "gray") +
  labs(x="Date", y = "Beer Consumption (litres)")
```

``` {r mo_consum, echo=FALSE}

ggplot(sim_data, aes(x = mo, y = consum, group = mo)) +
  geom_col() +
  scale_x_continuous(breaks = seq(1,12,1)) +
  labs(x="Month", y = "Beer Consumption (litres)")
```

#### Weekdays vs Weekends
``` {r weekend_corr, echo=FALSE}
ggplot(sim_data, aes(x = weekend, y = consum, group = weekend)) +
  geom_boxplot() +
  stat_summary(fun = "mean", aes(ymax = after_stat(y), ymin = after_stat(y)), 
               color = "red", shape = 4) +
  labs(y = "Beer Consumption (litres)")
```

### Simple Linear Regression

Simple linear regression of beer consumption was then performed using the median temperature as the predictor variable. The relationship between variables was then assessed by reviewing the P-Value and R-Squared value.

``` {r lm_temp_med, echo=FALSE}

temp_med_lm <- lm(formula = consum ~ temp_median, data = sim_data)

tidy(temp_med_lm)
# Coefficients
# Intercept: 20,5
# Slope: 0.239

glance(temp_med_lm)
# R-Squared - 0.0316

autoplot(temp_med_lm)[1:2]
# No clear pattern within the residuals and the qq plot looks normally distributed

summary(temp_med_lm)
# P-Value: 0.0006445
```

### Multiple Linear Regression

Due to the large variance in the model I thought it might be interesting to add other variables and try a multiple regression model to see if there was any improvement.

As there are only a small number of variables in the dataset I decided to use a forward selection approach starting with the median temperature included.

``` {r lm, echo=FALSE}

# First layer models
lm_1 <- lm(consum ~ temp_med + temp_min, data = sim_data)
lm_2 <- lm(consum ~ temp_med + temp_max, data = sim_data)
lm_3 <- lm(consum ~ temp_med + precip, data = sim_data)

# Combine models
models <- list(lm_1, lm_2, lm_3)

models_r_sqr <- models %>%
  map_df(function(linear_model) {
    tibble(
      the_model = as.character(linear_model$call)[2],
      adj_r_sqr = pull(glance(linear_model), adj.r.squared)
    )
  })

arrange(models_r_sqr, desc(adj_r_sqr))
```

Baseline adjusted r-squared with just median temperature was 0.02894. Adding in minimum temperature increased this to 0.0427 becoming the new baseline.

``` {r lm_1, echo=FALSE}

# Second layer models
lm_1_1 <- lm(consum ~ temp_med + temp_min + temp_max, data = sim_data)
lm_1_2 <- lm(consum ~ temp_med + temp_min + precip, data = sim_data)

# Combine models
models_1 <- list(lm_1_1, lm_1_2)

models_1_r_sqr <- models_1 %>%
  map_df(function(linear_model) {
    tibble(
      the_model = as.character(linear_model$call)[2],
      adj_r_sqr = pull(glance(linear_model), adj.r.squared)
    )
  })

arrange(models_1_r_sqr, desc(adj_r_sqr))
```

The best model had an r-squared of 0.0459 and used median, minimum and maximum temperature. The p-value of this model was lower at 0.0001703 compared to 0.0006445 of the original model using just median temperature. The Q-Q plot showed a normal distribution and the residuals plot displayed no clear pattern.

``` {r lm_1_analysis, echo=FALSE}

# P-Value: 0.0001703
summary(lm_1_1)

autoplot(lm_1_1)[1:2]
```

## Results



``` {r models_final, echo=FALSE}

# Comparison of simple and multiple linear regression
models_final <- list(temp_med_lm, lm_1_1)

final_r_sqr <- models_final %>%
  map_df(function(linear_model) {
    tibble(
      the_model = as.character(linear_model$call)[2],
      adj_r_sqr = pull(glance(linear_model), adj.r.squared)
    )
  })

arrange(final_r_sqr, desc(adj_r_sqr))
```

## Conclusion

The simple linear regression analysis produced a p-value of 0.0006445 which tells us that the relationship between temperature and beer consumption is significant and therefore we should reject the null hypotheses. However, the low R-Squared value of 0.0316 suggests that the simple linear regression model does not explain the variance in our data. This is evident when looking at a scatter plot of the data.

``` {r conclusion_1, echo=FALSE}
p_corr_temp_med
```

Moving to a multiple linear regression model improved the p-value to 0.0001703 and also improved the adjusted r-squared from 0.0289 to 0.0459. 

These are very minor improvements and I do not think they would change my analysis that we could loosely say that temperature does have an effect on beer consumption but the results don't confirm causation.

## References



